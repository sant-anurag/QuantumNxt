{% extends 'home.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/candidate_handle.css' %}">
<div class="candidate-container">
    <div class="candidate-pipeline-header">
        <h2>Candidate Pipeline</h2>
        <div class="filters-container">
            <div class="jd-filter">
                <div class="jd-dropdown">
                    <button class="jd-dropdown-btn" id="jd-dropdown-btn">
                        <span class="jd-selected-text">All Job Descriptions</span>
                        <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"></polyline>
                        </svg>
                    </button>
                    <div class="jd-dropdown-content" id="jd-dropdown-content">
                        <div class="jd-search-container">
                            <input type="text" id="jd-search-input" placeholder="Search job descriptions...">
                        </div>
                        <div class="jd-options" id="jd-options">
                            <div class="jd-option" data-jd-id="all">
                                <span class="jd-option-text">All Job Descriptions</span>
                            </div>
                            <!-- JD options will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search by name, phone, JD ID, or summary">
                <button id="search-button">Search</button>
            </div>
        </div>
    </div>
    <div id="candidates-cards-list">
        {% if candidate_info %}
            {% for candidate in candidate_info %}
            <div class="candidate-card">
                <div class="card-header">
                    <div class="initials-circle bg-blue">{{ candidate.initials }}</div>
                    <div class="profile-info">
                        <h3 class="candidate-name">{{ candidate.name }}</h3>
                        <div class="tooltip-container">
                            <p class="role-title">{{ candidate.job_summary }}</p>
                            <span class="tooltip-text">{{ candidate.job_summary }}</span>
                        </div>
                    </div>
                    <button class="action-btn view-resume">View Resume</button>
                </div>
                
                <div class="profile-progress-bar">
                    <span class="progress-label">82% Profile Complete</span>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 82%;"></div>
                    </div>
                </div>

                <div class="stage-tracker">
                    <div class="stage completed"></div>
                    <div class="stage active"></div>
                    <div class="stage upcoming"></div>
                    <div class="stage upcoming"></div>
                    <div class="stage upcoming"></div>
                    <div class="stage upcoming"></div>
                </div>

                <div class="current-stage-status">
                    <span class="status-label">Screening:</span>
                    <span class="status-value highlight-orange">Interview Scheduled</span>
                </div>

                <div class="candidate_actions">
                    <button class="action-btn primary add-note">Add Note</button>
                    <button class="action-btn primary">Take Action</button>
                </div>
                
            </div>

            {% endfor %}
        {% else %}
            <p>No candidates found.</p>
        {% endif %}
    </div>
</div>

<!-- Add Note Modal -->
<div id="addNoteModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Note</h3>
            <span class="close" id="closeAddNoteModal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="candidate-info">
                <div class="candidate-details">
                    <div class="candidate-avatar">
                        <span id="noteModalInitials">AS</span>
                    </div>
                    <div class="candidate-meta">
                        <h4 id="noteModalCandidateName">Candidate Name</h4>
                        <p id="noteModalJobTitle">Job Title</p>
                    </div>
                </div>
            </div>
            
            <form id="addNoteForm">
                <div class="form-group">
                    <label for="noteType">Note Type</label>
                    <select id="noteType" name="noteType" required>
                        <option value="">Select note type</option>
                        <option value="interview_feedback">Interview Feedback</option>
                        <option value="screening_notes">Screening Notes</option>
                        <option value="hr_notes">HR Notes</option>
                        <option value="technical_assessment">Technical Assessment</option>
                        <option value="offer_details">Offer Details</option>
                        <option value="onboarding">Onboarding</option>
                        <option value="general">General Note</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="noteTitle">Title</label>
                    <input type="text" id="noteTitle" name="noteTitle" placeholder="Enter note title" required>
                </div>
                
                <div class="form-group">
                    <label for="noteContent">Note</label>
                    <textarea id="noteContent" name="noteContent" rows="6" placeholder="Enter your note here..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="notePriority">Priority</label>
                    <select id="notePriority" name="notePriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelAddNote">Cancel</button>
            <button type="submit" form="addNoteForm" class="btn btn-primary">Save Note</button>
        </div>
    </div>
</div>

<!-- Take Action Modal -->
<div id="takeActionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Take Action</h3>
            <span class="close" id="closeTakeActionModal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="candidate-info">
                <div class="candidate-details">
                    <div class="candidate-avatar">
                        <span id="actionModalInitials">AS</span>
                    </div>
                    <div class="candidate-meta">
                        <h4 id="actionModalCandidateName">Candidate Name</h4>
                        <p id="actionModalJobTitle">Job Title</p>
                        <div class="current-stage">
                            <span class="stage-label">Current Stage:</span>
                            <span id="actionModalCurrentStage" class="stage-value">Screening</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <form id="takeActionForm">
                <div class="form-group">
                    <label for="actionType">Action Type</label>
                    <select id="actionType" name="actionType" required>
                        <option value="">Select action</option>
                        <option value="advance_stage">Advance to Next Stage</option>
                        <option value="reject">Reject Candidate</option>
                        <option value="put_on_hold">Put on Hold</option>
                        <option value="back_to_previous_stage">Back to Previous Stage</option>
                        <option value="schedule_interview">Schedule Interview</option>
                        <option value="send_offer">Send Offer</option>
                        <option value="manage_offer_status">Manage Offer Status</option>
                        <option value="manage_hiring_status">Manage Hiring Status</option>
                    </select>
                </div>
                
                <div class="form-group" id="rejectionReasonGroup" style="display: none;">
                    <label for="rejectionReason">Rejection Reason</label>
                    <select id="rejectionReason" name="rejectionReason">
                        <option value="">Select reason</option>
                        <option value="skills_mismatch">Skills Mismatch</option>
                        <option value="experience_insufficient">Insufficient Experience</option>
                        <option value="cultural_fit">Cultural Fit Issues</option>
                        <option value="salary_expectations">Salary Expectations</option>
                        <option value="availability">Availability Issues</option>
                        <option value="technical_assessment">Failed Technical Assessment</option>
                        <option value="interview_performance">Poor Interview Performance</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group" id="holdReasonGroup" style="display: none;">
                    <label for="holdReason">Hold Reason</label>
                    <select id="holdReason" name="holdReason">
                        <option value="">Select reason</option>
                        <option value="budget_review">Budget Under Review</option>
                        <option value="hiring_freeze">Hiring Freeze</option>
                        <option value="position_review">Position Requirements Review</option>
                        <option value="team_availability">Team Availability</option>
                        <option value="candidate_request">Candidate Request</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group" id="interviewDetailsGroup" style="display: none;">
                    <label for="interviewDate">Interview Date & Time</label>
                    <input type="datetime-local" id="interviewDate" name="interviewDate">
                    
                    <label for="interviewType">Interview Type</label>
                    <select id="interviewType" name="interviewType">
                        <option value="phone">Phone Interview</option>
                        <option value="video">Video Interview</option>
                        <option value="in_person">In-Person Interview</option>
                        <option value="technical">Technical Assessment</option>
                    </select>
                    
                    <label for="interviewLevel">Interview Level</label>
                    <select id="interviewLevel" name="interviewLevel">
                        <option value="">Select level</option>
                        <option value="l1">L1 - Initial Screening</option>
                        <option value="l2">L2 - Technical Interview</option>
                        <option value="l3">L3 - Final Interview</option>
                    </select>
                    
                    <label for="interviewer">Interviewer</label>
                    <input type="text" id="interviewer" name="interviewer" placeholder="Enter interviewer name">
                    
                    <label for="interviewerEmail">Interviewer Email</label>
                    <input type="email" id="interviewerEmail" name="interviewerEmail" placeholder="Enter interviewer email">
                    
                    <label for="interviewLink">Interview Link</label>
                    <input type="text" id="interviewLink" name="interviewLink" placeholder="Enter interview link (Zoom, Teams, etc.)">
                </div>

                <div class="form-group" id="offerDetailsGroup" style="display: none;">
                    <h4 style="margin: 0 0 16px 0; color: #374151; font-size: 1.1rem;">Salary Breakdown</h4>
                    
                    <div class="salary-row">
                        <div>
                            <label for="basicSalary">Basic Salary *</label>
                            <input type="number" id="basicSalary" name="basicSalary" placeholder="Enter basic salary">
                        </div>
                        <div>
                            <label for="hra">HRA *</label>
                            <input type="number" id="hra" name="hra" placeholder="Enter HRA">
                        </div>
                    </div>
                    
                    <div class="salary-row">
                        <div>
                            <label for="specialAllowance">Special Allowance</label>
                            <input type="number" id="specialAllowance" name="specialAllowance" placeholder="Enter Special Allowance">
                        </div>
                        <div>
                            <label for="pf">PF Contribution *</label>
                            <input type="number" id="pf" name="pf" placeholder="Enter PF">
                        </div>
                    </div>
                    <div class="salary-row">
                        <div>
                            <label for="gratuity">Gratuity</label>
                            <input type="number" id="gratuity" name="gratuity" placeholder="Enter Gratuity">
                        </div>
                        <div>
                            <label for="bonus">Bonus</label>
                            <input type="number" id="bonus" name="bonus" placeholder="Enter bonus amount">
                        </div>
                    </div>
                    
                    <div>
                        <label for="other">Other Benefits</label>
                        <input type="number" id="other" name="other" placeholder="Enter Other allowances">
                    </div>
                    
                    <div class="salary-total">
                        <label for="totalSalary">Total Annual Package</label>
                        <input type="number" id="totalSalary" name="totalSalary" placeholder="Auto-calculated total" readonly>
                    </div>
                    <div class="joining-date">
                        <label for="joiningDate">Joining Date *</label>
                        <input type="date" id="joiningDate" name="joiningDate">
                    </div>
                </div>

                <div class="form-group" id="offerStatusManageGroup" style="display: none;">
                    <label for="offerStatus">Offer Status</label>
                    <select id="offerStatus" name="offerStatus">
                        <option value="withdraw">Withdraw</option>
                        <option value="accepted">Accepted</option>
                        <option value="rejected">Rejected</option>
                        <option value="onHold">On Hold</option>
                    </select>
                </div>

                <div class="form-group" id="hiringStatusManageGroup" style="display: none;">
                    <label for="hiringStatus">Hiring Status</label>
                    <select id="hiringStatus" name="hiringStatus">
                        <option value="in_progress">In Progress</option>
                        <option value="onHold">On Hold</option>
                        <option value="joined">Joined</option>
                        <option value="not_joined">Not Joined</option>
                        <option value="resigned">Resigned</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="actionComments">Comments</label>
                    <textarea id="actionComments" name="actionComments" rows="4" placeholder="Add any additional comments..."></textarea>
                </div>
                
                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="notifyCandidate" name="notifyCandidate" checked>
                        <span class="checkmark"></span>
                        Notify candidate via email
                    </label>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancelTakeAction">Cancel</button>
            <button type="submit" form="takeActionForm" class="btn btn-primary">Execute Action</button>
        </div>
    </div>
</div>

<!-- Edit candidate modal -->
<div id="candidate-modal" class="modal">
    <div class="modal-content">
        <!-- Loading overlay for modal -->
        <div id="modal-loading-overlay" class="modal-loading-overlay" style="display: none;">
            <div class="modal-loading-content">
                <div class="modal-loading-spinner"></div>
                <div class="modal-loading-text">Loading candidate data, please wait...</div>
            </div>
        </div>
        
        <div class="modal-header">
            <h3>Record Candidate Details</h3>
            <span class="close" id="modal-close-header">&times;</span>
        </div>
        
        <form id="candidate-form" class="candidate-form">
            <input type="hidden" id="modal-resume-id">
            <input type="hidden" id="modal-jd-id">
            <input type="hidden" id="modal-team-id">

            <!-- Personal Information Section -->
            <div class="form-section personal-info">
                <div class="form-field">
                    <label for="modal-name">Name<span class="required">*</span></label>
                    <input type="text" id="modal-name" maxlength="100">
                </div>
                <div class="form-field">
                    <label for="modal-phone">Phone<span class="required">*</span></label>
                    <input type="text" id="modal-phone" maxlength="20">
                </div>
                <div class="form-field">
                    <label for="modal-email">Email<span class="required">*</span></label>
                    <input type="email" id="modal-email" maxlength="100">
                </div>
            </div>

            <!-- Professional Information Section -->
            <div class="form-section professional-info">
                <div class="form-field">
                    <label for="modal-skills">Skills</label>
                    <textarea id="modal-skills" maxlength="500" rows="3" placeholder="Enter skills separated by commas or new lines"></textarea>
                </div>
                <div class="form-field">
                    <label for="modal-education">Education</label>
                    <textarea id="modal-education" maxlength="500" rows="3" placeholder="Enter education details"></textarea>
                </div>
                <div class="form-field">
                    <label for="modal-experience">Experience (years)</label>
                    <input type="number" id="modal-experience" min="0" step="0.1" maxlength="20" placeholder="e.g., 2.5">
                </div>
                <div class="form-field">
                    <label for="modal-relevant-experience">Relevant Experience (years)</label>
                    <input type="number" id="modal-relevant-experience" min="0" step="0.1" maxlength="20" placeholder="e.g., 1.5">
                </div>
                <div class="form-field">
                    <label for="modal-prev-job-profile">Previous Job Profile</label>
                    <input type="text" id="modal-prev-job-profile" maxlength="255">
                </div>
            </div>

            <!-- Compensation & Location Section -->
            <div class="form-section compensation-info">
                <div class="form-field form-field-ctc">
                    <label for="modal-current-ctc">Current CTC</label>
                    <div class="ctc-input-group">
                        <input type="number" id="modal-current-ctc" min="0" step="0.01" maxlength="20" placeholder="e.g., 500000.50">
                        <select id="modal-current-ctc-basis" class="ctc-basis-select">
                            <option value="hourly">Hourly</option>
                            <option value="daily">Daily</option>
                            <option value="monthly">Monthly</option>
                            <option value="annual" selected>Annual</option>
                        </select>
                    </div>
                </div>
                <div class="form-field form-field-ctc">
                    <label for="modal-expected-ctc">Expected CTC</label>
                    <div class="ctc-input-group">
                        <input type="number" id="modal-expected-ctc" min="0" step="0.01" maxlength="20" placeholder="e.g., 600000.75">
                        <select id="modal-expected-ctc-basis" class="ctc-basis-select">
                            <option value="hourly">Hourly</option>
                            <option value="daily">Daily</option>
                            <option value="monthly">Monthly</option>
                            <option value="annual" selected>Annual</option>
                        </select>
                    </div>
                </div>
                <div class="form-field">
                    <label for="modal-notice-period">Notice Period (days)</label>
                    <input type="number" id="modal-notice-period" min="0" step="1" maxlength="3" oninput="this.value = this.value.replace(/[^\d]/g, '')">
                </div>
                <div class="form-field">
                    <label for="modal-location">Location</label>
                    <input type="text" id="modal-location" maxlength="100">
                </div>
            </div>

            <!-- Screening Information Section -->
            <div class="form-section screening-info">
                <div class="form-field">
                    <label for="modal-screen-status">Screen Status<span class="required">*</span></label>
                    <select id="modal-screen-status">
                        <option value="toBeScreened">To Be Screened</option>
                        <option value="selected">Selected</option>
                        <option value="rejected">Rejected</option>
                        <option value="onHold">On Hold</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="modal-screening-team">Screening Team<span class="required">*</span></label>
                    <input type="text" id="modal-screening-team" readonly>
                </div>
                <div class="form-field">
                    <label for="modal-hr-member-id">Assigned To<span class="required">*</span></label>
                    <select id="modal-hr-member-id"></select>
                </div>
            </div>

            <!-- Date Information Section -->
            <div class="form-section date-info">
                <div class="form-field">
                    <label for="modal-screened-on">Screened On</label>
                    <input type="date" id="modal-screened-on">
                </div>
                <div class="form-field">
                    <label for="modal-shared-on">Shared On</label>
                    <input type="date" id="modal-shared-on">
                </div>
            </div>

            <!-- Comments Section -->
            <div class="form-section comments-info">
                <div class="form-field form-field-full">
                    <label for="modal-screened-remarks">Screened Remarks</label>
                    <textarea id="modal-screened-remarks" maxlength="500"></textarea>
                </div>
                <div class="form-field form-field-full">
                    <label for="modal-recruiter-comments">Recruiter Comments</label>
                    <textarea id="modal-recruiter-comments" maxlength="200"></textarea>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" id="modal-close-btn" class="btn btn-secondary">Close</button>
                <button type="button" id="modal-save-btn" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>
<script src="{% static 'js/candidate_handle.js' %}"></script>
{% endblock %}