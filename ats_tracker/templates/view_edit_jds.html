{% extends "home.html" %}
    {% load static %}
    {% block content %}
    <link rel="stylesheet" href="{% static 'css/view_edit_jds.css' %}">
    <!-- Quill.js CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <div class="jd-main" data-user-role="{{ user_role }}">
        <header class="jd-header">
            <h2><i class="fas fa-file-alt"></i> View/Edit JDs</h2>
            <div class="jd-search-container" style="display: flex; align-items: center; justify-content: flex-start; gap: 12px;">
                <i class="fas fa-search" style="font-size: 1.5em; color: #5661d2;"></i>
                <input type="text" id="jd-search" class="jd-search-box" placeholder="Search by JD ID, Team, or Summary...">
                <button id="jd-search-btn" class="jd-search-btn">Search</button>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <div id="showing-results" class="jd-results-counter" style="font-size: 0.9rem; color: #666;">
                    Loading JDs...
                </div>
                <div class="jd-toggle">
                    <button id="toggle-view" class="jd-btn-toggle" title="Switch View">
                        <i class="fas fa-th-large"></i> <span id="toggle-view-label">Cards</span>
                    </button>
                </div>
            </div>
        </header>
        <div id="jd-table-view" class="jd-table-container">
            <div class="table-container-jd">
                <table class="jd-table">
                    <thead>
                        <tr>
                            <th>JD ID</th>
                            <th>Summary</th>
                            <th>Status</th>
                            <th>Positions</th>
                            <th>Company</th>
                            <th>Team</th>
                            <th>Closure</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="jd-table-body">
                        <!-- JDs will be dynamically inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div id="jd-table-pagination" class="jd-pagination"></div>
        </div>
        <div id="jd-card-view" class="jd-card-list" style="display:none;">
            <!-- Cards will be dynamically inserted here by JavaScript -->
        </div>
        <div id="jd-card-pagination" class="jd-pagination" style="display:none;"></div>
    </div>

    <!-- PDF-Style View Modal -->
    <div id="jd-view-modal-overlay" class="jd-view-modal-overlay" style="display:none;">
        <div class="jd-view-modal-content">
            <span class="jd-view-close-modal" id="jd-view-close-modal">&times;</span>
            <div class="jd-document-container">
                <div class="jd-document-header">
                    <h1 class="jd-document-title">Job Description</h1>
                    <div class="jd-document-meta">
                        <span class="jd-doc-id">JD ID: <span id="view-jd-id"></span></span>
                        <span class="jd-doc-date">Date Created: <span id="view-created-date"></span></span>
                    </div>
                </div>

                <div class="jd-document-body">
                    <section class="jd-doc-section">
                        <h2 class="jd-doc-section-title">Position Summary</h2>
                        <p class="jd-doc-content" id="view-jd-summary"></p>
                    </section>

                    <section class="jd-doc-section">
                        <h2 class="jd-doc-section-title">Job Description</h2>
                        <div class="jd-doc-content" id="view-jd-description"></div>
                    </section>

                    <section class="jd-doc-section">
                        <h2 class="jd-doc-section-title">Required Skills</h2>
                        <ul class="jd-doc-content" id="view-must-have-skills">
                            <!-- Skills will be populated by JavaScript -->
                        </ul>
                    </section>

                    <section class="jd-doc-section">
                        <h2 class="jd-doc-section-title">Preferred Skills</h2>
                        <ul class="jd-doc-content" id="view-good-to-have-skills">
                            <!-- Skills will be populated by JavaScript -->
                        </ul>
                    </section>

                    <div class="jd-doc-row">
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Experience Required</h2>
                            <p class="jd-doc-content" id="view-experience"></p>
                        </section>
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Education Required</h2>
                            <p class="jd-doc-content" id="view-education"></p>
                        </section>
                    </div>

                    <div class="jd-doc-row">
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Budget/CTC</h2>
                            <p class="jd-doc-content" id="view-budget"></p>
                        </section>
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Location</h2>
                            <p class="jd-doc-content" id="view-location"></p>
                        </section>
                    </div>

                    <div class="jd-doc-row">
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Number of Positions</h2>
                            <p class="jd-doc-content" id="view-positions"></p>
                        </section>
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Status</h2>
                            <p class="jd-doc-content" id="view-status"></p>
                        </section>
                    </div>

                    <div class="jd-doc-row">
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Company</h2>
                            <p class="jd-doc-content" id="view-company"></p>
                        </section>
                        <section class="jd-doc-section jd-doc-half">
                            <h2 class="jd-doc-section-title">Team</h2>
                            <p class="jd-doc-content" id="view-team"></p>
                        </section>
                    </div>

                    <section class="jd-doc-section" id="view-closure-section" style="display: none;">
                        <h2 class="jd-doc-section-title">Closure Date</h2>
                        <p class="jd-doc-content" id="view-closure-date"></p>
                    </section>
                </div>

                <div class="jd-document-footer">
                    <div class="jd-doc-actions">
                        <button type="button" id="jd-print-btn" class="jd-doc-btn jd-doc-btn-primary">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button type="button" id="jd-edit-from-view-btn" class="jd-doc-btn jd-doc-btn-secondary">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button type="button" id="jd-view-close-btn" class="jd-doc-btn jd-doc-btn-tertiary">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal Overlay -->
    <div id="jd-modal-overlay" class="jd-modal-overlay" style="display:none;">
        <div class="jd-modal-content">
            <span class="jd-close-modal" id="jd-close-modal">&times;</span>
            <form id="jd-edit-form">
                <h3 style="color: #666de7;"><i class="fas fa-edit"></i> Edit JD Details</h3>
                <div class="jd-form-row">
                    <div class="jd-form-group">
                        <label>JD ID</label>
                        <input type="text" name="jd_id" id="jd_id" readonly>
                    </div>
                    <div class="jd-form-group">
                        <label>Summary</label>
                        <input type="text" name="jd_summary" id="jd_summary" required>
                    </div>
                </div>
                <div class="jd-form-row">
                    <div class="jd-form-group">
                        <label>Description</label>
                        <div style="margin-bottom: 10px;">
                            <button type="button" id="formatTextBtnModal" class="jd-btn-secondary" style="font-size: 12px; padding: 5px 10px; background-color: #6c757d; color: white; border: none; border-radius: 3px; cursor: pointer; margin-bottom: 5px;">
                                üìù Format Pasted Text (Convert Line Breaks)
                            </button>
                            <small style="color: #666; margin-left: 10px; display: block;">Click after pasting text from PDF to properly format line breaks</small>
                        </div>
                        <div id="jd_description_editor" style="height: 150px; background-color: white;"></div>
                        <input type="hidden" name="jd_description" id="jd_description" required>
                    </div>
                </div>
                <div class="jd-form-row jd-skills-row">
                    <div class="jd-form-group">
                        <label>Must Have Skills</label>
                        <textarea name="must_have_skills" id="must_have_skills" rows="3" placeholder="Enter required skills, one per line or separated by commas"></textarea>
                    </div>
                    <div class="jd-form-group">
                        <label>Good to Have Skills</label>
                        <textarea name="good_to_have_skills" id="good_to_have_skills" rows="3" placeholder="Enter preferred skills, one per line or separated by commas"></textarea>
                    </div>
                </div>
                <div class="jd-form-row">
                    <div class="jd-form-group">
                        <label>Experience required</label>
                        <input type="text" name="experience" id="experience" placeholder="e.g. 2-5 years">
                    </div>
                    <div class="jd-form-group">
                        <label>Education Required</label>
                        <input type="text" name="education" id="education" placeholder="e.g. B.Tech, MBA">
                    </div>
                </div>
                <div class="jd-form-row">
                    <div class="jd-form-group">
                        <label>Budget/CTC</label>
                        <input type="text" name="budget_ctc" id="budget_ctc" min="1", placeholder="e.g. INR 10-15 LPA, USD 20-30K">
                    </div>
                    <div class="jd-form-group">
                        <label>Location</label>
                        <input type="text" name="location" id="location" placeholder="e.g. Remote, On-site">
                    </div>
                </div>
                <div class="jd-form-row">
                    <div class="jd-form-group">
                        <label>No. of Positions</label>
                        <input type="number" name="no_of_positions" id="no_of_positions" min="1">
                    </div>
                </div>
                <div class="jd-form-row">
                    <div class="jd-form-group">
                        <label>Status</label>
                        <select name="jd_status" id="jd_status">
                            <option value="active">Active</option>
                            <option value="closed">Closed</option>
                            <option value="on hold">On Hold</option>
                        </select>
                    </div>
                    <div class="jd-form-group">
                        <label>Company</label>
                        <select name="company_id" id="company_id">
                            {% for c in companies %}
                                <option value="{{ c.company_id }}">{{ c.company_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="jd-form-row">
                    <div class="jd-form-group">
                        <label>Team</label>
                        <select name="team_id" id="team_id">
                            {% for t in teams %}
                                <option value="{{ t.team_id }}">{{ t.team_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="jd-form-group">
                        <label>Closure Date</label>
                        <input type="date" name="closure_date" id="closure_date">
                    </div>
                </div>
                <div class="jd-modal-actions">
                    <button type="button" id="jd-edit-btn" class="jd-btn-primary"><i class="fas fa-edit"></i> Edit</button>
                    <button type="submit" id="jd-save-btn" class="jd-btn-success" disabled><i class="fas fa-save"></i> Save</button>
                    <button type="button" id="jd-close-btn" class="jd-btn-secondary"><i class="fas fa-times"></i> Close</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Quill.js JavaScript -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <script src="{% static 'js/view_edit_jds.js' %}"></script>
    <script src="{% static 'js/view_edit_jds_admin.js' %}"></script>
    {% endblock %}