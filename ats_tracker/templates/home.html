{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ATS Home</title>
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/notification_popup.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.0.4/dist/tailwind.min.css">

</head>
<body>
<div class="application-container">
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button id="sidebar-toggle" class="sidebar-toggle" title="Toggle Sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="sidebar-header-content">
                <div class="sidebar-logo-container">
                    <img src="{% static 'images/logo.png' %}" alt="ProtonNXT Logo" class="sidebar-logo" />
                </div>
                <div class="sidebar-welcome-section">
                    <h2 class="qnxt-aura">Welcome</h2>
                    {% if name %}<span class="sidebar-emp-name">{{ name }}</span>{% endif %}
                </div>
            </div>
        </div>
        <ul class="menu">
            <li>
                <a href="{% url 'home' %}"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a>
            </li>
            {% if user_role == "Admin" or user_role == "SuperUser" %}
                <li>
                    <a href="{% url 'admin_dashboard' %}"><i class="fas fa-chart-line"></i> <span>Admin Dashboard</span></a>
                </li>
                <li>
                    <a href="#"><i class="fas fa-users"></i> <span>Teams</span></a>
                    <ul class="submenu">
                        <li><a href="{% url 'add_member' %}"><i class="fas fa-user-plus"></i> <span>Add Member</span></a></li>
                        <li><a href="{% url 'manage_members' %}"><i class="fas fa-users"></i> <span>View Members</span></a></li>
                        <li><a href="{% url 'create_team' %}"><i class="fas fa-users-cog"></i> <span>Create Team</span></a></li>
                        <li><a href="{% url 'view_edit_teams' %}"><i class="fas fa-edit"></i> <span>Manage Teams</span></a></li>
                    </ul>
                </li>
            {% endif %}
            <li>
                <a href="#"><i class="fas fa-tasks"></i> <span>Recruitment Tasks</span></a>
                <ul class="submenu">
                    <li><a href="{% url 'jd_create' %}"><i class="fas fa-file-medical"></i> <span>Create New JD</span></a></li>
                    <li><a href="{% url 'view_edit_jds' %}"><i class="fas fa-list-alt"></i> <span>View/Edit JDs</span></a></li>
                    {% if user_role == "Admin" or user_role == "SuperUser" %}
                        <li><a href="{% url 'assign_jd_page' %}"><i class="fas fa-user-tag"></i> <span>Assign JDs</span></a></li>
                    {% endif %}
                    <li><a href="{% url 'employee_view_page' %}"><i class="fas fa-user-friends"></i> <span>Employee View</span></a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fas fa-file-alt"></i> <span>Manage resume</span></a>
                <ul class="submenu">
                    <li><a href="{% url 'upload_resume_page' %}"><i class="fas fa-file-upload"></i> <span>Upload Resume</span></a></li>
                    <li><a href="{% url 'view_parse_resumes_page' %}?jd_id=1"><i class="fas fa-search"></i> <span>View/Screen Resumes</span></a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fas fa-calendar-check"></i> <span>Interview Workflow</span></a>
                <ul class="submenu">
                    <li><a href="{% url 'schedule_interviews_page' %}"><i class="fas fa-calendar-plus"></i> <span>Schedule Interviews</span></a></li>
                    <li><a href="{% url 'manage_candidate_status' %}"><i class="fas fa-user-check"></i> <span>Manage Candidate Status</span></a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fas fa-user-tie"></i> <span>Candidates</span></a>
                <ul class="submenu">
                    <li><a href="{% url 'candidate_pipeline' %}"><i class="fas fa-user-check"></i> <span>Candidate Pipeline</span></a></li>
                    <li><a href="{% url 'candidate_muster' %}"><i class="fas fa-users"></i> <span>Candidate Muster</span></a></li>
                    <li><a href="{% url 'view_finalized_candidates' %}"><i class="fas fa-check-circle"></i> <span>View Finalized Candidates</span></a></li>
                    <li><a href="{% url 'candidate_profile' %}"><i class="fas fa-id-card"></i> <span>Candidate Profiles</span></a></li>
                    <li><a href="{% url 'offer_letter' %}"><i class="fas fa-file-signature"></i> <span>Offer Letter Management</span></a></li>
                </ul>
            </li>
            <li>
                <a href="#"><i class="fas fa-building"></i> <span>Customers</span></a>
                <ul class="submenu">
                    {% if user_role == "Admin" or user_role == "SuperUser" %}
                        <li><a href="{% url 'create_customer' %}"><i class="fas fa-plus-circle"></i> <span>Create Customer</span></a></li>
                    {% endif %}
                    <li><a href="{% url 'customer_details' %}"><i class="fas fa-list"></i> <span>Customer Details</span></a></li>
                </ul>
            </li>
            {% if user_role == "Admin" or user_role == "SuperUser" %}
                <li>
                    <a href="#"><i class="fas fa-chart-bar"></i> <span>Reports & Analytics</span></a>
                    <ul class="submenu">
                        <li><a href="{% url 'team_reports' %}"><i class="fas fa-users-cog"></i> <span>Team-wise Reports</span></a></li>
                        <li><a href="{% url 'task_progress_reports' %}"><i class="fas fa-tasks"></i> <span>Task Progress Reports</span></a></li>
                        <li><a href="{% url 'status_report' %}"><i class="fas fa-file-excel"></i> <span>Status Report</span></a></li>
                        <li><a href="{% url 'candidate_conversion_rates' %}"><i class="fas fa-chart-line"></i> <span>Conversion Analytics</span></a></li>
                    </ul>
                </li>
            {% endif %}
            <li>
                <a href="#"><i class="fas fa-cog"></i> <span>Settings</span></a>
                <ul class="submenu">
                    <li><a href="{% url 'user_profile' %}"><i class="fas fa-user"></i> <span>User Profile</span></a></li>
                    <li><a href="{% url 'notification_settings' %}"><i class="fas fa-bell"></i> <span>Notification</span></a></li>
                    <li><a href="{% url 'save_email_config' %}"><i class="fas fa-envelope"></i> <span>Email Config</span></a></li>
                    <li><a href="{% url 'access_permissions' %}"><i class="fas fa-shield-alt"></i> <span>Access & Permissions</span></a></li>
                    {% if user_role == "Admin" or user_role == "SuperUser" %}
                        <li><a href="{% url 'manage_sessions' %}"><i class="fas fa-user-lock"></i> <span>Manage Sessions</span></a></li>
                    {% endif %}
                </ul>
            </li>
            <!-- add a logout menu item-->
            <li>
                <a href="{% url 'prelogout' %}"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a>
            </li>

        </ul>
    </div>
    <!-- ats_tracker/templates/home.html -->
    <div class="main-content">
        <div class="qnxt-header-gradient">
            <h1>ProtonNxt</h1>
        </div>
        <div class="qnxt-body">
            {% block content %}
            {% load static %}
            
            <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
            <div class="dashboard-container">

                <div class="dashboard-shortcuts">
                    {% if user_role == "Admin" or user_role == "SuperUser" %}
                        <button class="shortcut-btn" onclick="location.href='{% url 'create_customer' %}'">
                            <i class="fas fa-building"></i> Create Customer
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'add_member' %}'">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'create_team' %}'">
                            <i class="fas fa-users-cog"></i> Create Team
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'jd_create' %}'">
                            <i class="fas fa-file-medical"></i> Create JD
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'assign_jd_page' %}'">
                            <i class="fas fa-tasks"></i> Assign JD
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'generate_export_report' %}?report_type=daily'">
                            <i class="fas fa-download"></i> Download Daily Report
                        </button>
                    {% endif %}
                    {% if user_role == "Team_Lead" or user_role == "User" %}
                        <button class="shortcut-btn" onclick="location.href='{% url 'jd_create' %}'">
                            <i class="fas fa-file-medical"></i> Create JD
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'upload_resume_page' %}'">
                            <i class="fas fa-file-upload"></i> Upload Resume
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'view_parse_resumes_page' %}'">
                            <i class="fas fa-eye"></i> View/Screen Resumes
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'candidate_pipeline' %}'">
                            <i class="fas fa-user-friends"></i> Candidate Pipeline
                        </button>
                        <button class="shortcut-btn" onclick="location.href='{% url 'generate_export_report' %}?report_type=daily'">
                            <i class="fas fa-download"></i> Download Daily Report
                        </button>
                    {% endif %}

                    
                </div>
                <div class="dashboard-sections">
                    <div class="dashboard-left">
                        <div class="dashboard-card">
                            <h3>Pending/Active Recruitment JDs</h3>
                            <table class="dashboard-table" id="pending-jds-table">
                                <thead>
                                <tr>
                                    <th>JD ID</th>
                                    <th>Summary</th>
                                    <th>Customer</th>
                                    <th>Status</th>
                                    <th>In-Progress Profiles</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div class="dashboard-card">
                            <h3>Monthly Closed JDs & Candidates</h3>
                            <table class="dashboard-table" id="monthly-report-table">
                                <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Closed JDs</th>
                                    <th>Candidates</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="dashboard-right">
                        <div class="dashboard-card">
                            <h3>Active JDs by Customer</h3>
                            <canvas id="customerPieChart"></canvas>
                        </div>
                        <div class="dashboard-card">
                            <h3>Closed JDs (Last 6 Months)</h3>
                            <canvas id="closedJDsBarChart"></canvas>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="dashboard-card">
                        <h3>In Progress Candidates</h3>
                        <div class="table-container">
                            <table class="dashboard-table" id="in-progress-candidates-table">
                                <thead>
                                <tr>
                                    <th>Candidate ID</th>
                                    <th>Name</th>
                                    <th>JD ID</th>
                                    <th>L1 Status</th>
                                    <th>L2 Status</th>
                                    <th>L3 Status</th>
                                    <th>Customer</th>
                                    <th>Assigned Team</th>
                                    <th>Last Updated</th>
                                    <th>Recruiter Comments</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!-- Filled by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="{% static 'js/dashboard.js' %}"></script>
            {% endblock %}
        </div>
    </div>
</div>
<!-- Notifications -->
<div class="notifications-panel" id="notifications-panel">
    <button id="notification-panel-close" style="position:absolute;top:12px;right:16px;background:transparent;border:none;color:#64748b;font-size:1.3em;cursor:pointer;z-index:10001;">
        <i class="fas fa-times"></i>
    </button>
    <h2 style="padding-right:32px;">Notifications</h2>
    <ul id="notification-list" class="notifications-list">
        <!-- Notifications will be dynamically populated here -->
        
    </ul>
</div>

<!-- Floating Notification Bell Icon -->
<div id="notification-bell-container" class="fixed bottom-8 right-8 z-[10000]">
    <button id="notification-bell" class="bg-blue-600 border-none rounded-full w-14 h-14 shadow-lg flex items-center justify-center cursor-pointer relative">
        <i class="fas fa-bell text-white text-2xl"></i>
        <span id="notification-badge" class="absolute top-2 right-2 bg-red-500 text-white rounded-full px-2 py-0.5 text-sm font-semibold min-w-[22px] text-center hidden"></span>
    </button>
</div>

<!-- Notifications Popup Panel -->
<div class="notifications-panel">
    <h2>Notifications</h2>
    <ul id="notification-list" class="notifications-list">
        <!-- Notifications will be dynamically populated here -->
        <!--
        <li class="notification-item" id="notification-1">
            <div class="notification-sender">System</div>
            <div class="notification-meta">
                <div class="notification-date">2023-10-01</div>
                <div class="notification-time">10:30 AM</div>
            </div>
            <div class="notification-content">
                <div class="notification-type">New Candidate Application</div>
                <div class="notification-text">This will be the notification text</div>
            </div>
            <button class="notification-cancel" id="cancel-notification-2"><i class="fas fa-times"></i></button>
        </li>
        -->
    </ul>
</div>


<script src="{% static 'js/notifications.js' %}"></script>
<script src="{% static 'js/home.js' %}"></script>
<script>
// Floating bell and notification panel logic with dissolve/pop-in animation
</script>
</body>
</html>